{{- $data := dict
  "Kind" "StatefulSet"
  "Image" "eclipse-mosquitto"
  "PriorityClassName" "powerpi-critical"
  "Ports" (list (dict
    "Name" "mqtt"
    "Port" 1883
  ))
  "NodeSelector" (list
    (dict
      "Name" "powerpi-storage"
      "Value" "true"
    )
  )
  "PersistentVolumeClaim" (dict
    "Name" "mosquitto-data"
    "Path" "/mosquitto/data"
  )
  "Config" (list
    (dict
      "Name" "mosquitto-config"
      "Path" "/mosquitto/config/mosquitto.conf"
      "SubPath" "mosquitto.conf"
    )
  )
}}
{{- include "powerpi.deployment" (merge (dict "Params" $data) . )}}
