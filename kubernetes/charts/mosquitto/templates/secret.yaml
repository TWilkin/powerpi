apiVersion: v1
kind: Secret
metadata:
  name: mosquitto-api-secret
  {{- include "powerpi.labels" . }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
data:
  username: {{ "api" | b64enc | quote }}
  {{- include "powerpi.generate-secret" (merge (dict "Params" (dict
    "Name" "mosquitto-api-secret"
    "Key" "password"
  )) . ) -}}

{{- if eq .Values.global.config true }}
---
apiVersion: v1
kind: Secret
metadata:
  name: mosquitto-config-secret
  {{- include "powerpi.labels" . }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
data:
  username: {{ "config" | b64enc | quote }}
  {{- include "powerpi.generate-secret" (merge (dict "Params" (dict
    "Name" "mosquitto-config-secret"
    "Key" "password"
  )) . ) -}}
{{- end }}
---

apiVersion: v1
kind: Secret
metadata:
  name: mosquitto-controller-secret
  {{- include "powerpi.labels" . }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
data:
  username: {{ "controller" | b64enc | quote }}
  {{- include "powerpi.generate-secret" (merge (dict "Params" (dict
    "Name" "mosquitto-controller-secret"
    "Key" "password"
  )) . ) -}}

{{- if eq .Values.global.persistence true }}
---
apiVersion: v1
kind: Secret
metadata:
  name: mosquitto-persistence-secret
  {{- include "powerpi.labels" . }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
data:
  username: {{ "persistence" | b64enc | quote }}
  {{- include "powerpi.generate-secret" (merge (dict "Params" (dict
    "Name" "mosquitto-persistence-secret"
    "Key" "password"
  )) . ) -}}
{{- end }}

{{- if eq .Values.global.useSensors true }}
---
apiVersion: v1
kind: Secret
metadata:
  name: mosquitto-sensor-secret
  {{- include "powerpi.labels" . }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
data:
  username: {{ "sensor" | b64enc | quote }}
  {{- include "powerpi.generate-secret" (merge (dict "Params" (dict
    "Name" "mosquitto-sensor-secret"
    "Key" "password"
  )) . ) -}}
{{- end }}
