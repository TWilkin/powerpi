{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://raw.githubusercontent.com/TWilkin/powerpi/main/kubernetes/values.schema.json",
    "title": "PowerPi Helm Chart",
    "description": "The configuration for the PowerPi Helm deployment",
    "type": "object",
    "properties": {
        "global": {
            "$ref": "#/$defs/global"
        },

        "config-server": {
            "description": "The configuration for the PowerPi Config Server Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "config"
                },
                "global": {
                    "$ref": "#/$defs/global"
                },
                "schedule": {
                    "description": "The cron schedule for when the Config Server should run",
                    "type": "string"
                },
                "path": {
                    "description": "The path in the GitHub repository to the configuration files",
                    "type": "string"
                },
                "branch": {
                    "description": "The branch in the GitHub repository to get the configuration files",
                    "type": "string"
                }
            },
            "additionalProperties": false
        },

        "database": {
            "description": "The configuration for the PowerPi Database Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "database"
                },
                "global": {
                    "$ref": "#/$defs/global"
                },
                "backupSchedule": {
                    "description": "The cron schedule for when the database backup should run",
                    "type": "string"
                }
            },
            "additionalProperties": false
        },

        "deep-thought": {
            "description": "The configuration for the PowerPi API service Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "api"
                },
                "global": {
                    "$ref": "#/$defs/global"
                }
            },
            "additionalProperties": false
        },

        "energenie-controller": {
            "description": "The configuration for the PowerPi Energenie controller Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "controller"
                },
                "global": {
                    "$ref": "#/$defs/global"
                },
                "type": {
                    "description": "The Energenie device type to use, either ENER314-RT or ENER314",
                    "enum": ["ENER314-RT", "ENER314"]
                }
            },
            "additionalProperties": false
        },

        "energy-monitor": {
            "description": "The configuration for the PowerPi Energy Monitor service Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "energy-monitor"
                },
                "global": {
                    "$ref": "#/$defs/global"
                },
                "schedule": {
                    "description": "The cron schedule for when the Energy Monitor service should run",
                    "type": "string"
                },
                "history": {
                    "description": "How many days to collect data for",
                    "type": "integer",
                    "min": 1,
                    "max": 720
                }
            },
            "additionalProperties": false
        },

        "freedns": {
            "description": "The configuration for the PowerPi FreeDNS service Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "dns"
                },
                "global": {
                    "$ref": "#/$defs/global"
                },
                "schedule": {
                    "description": "The cron schedule for when the FreeDNSr service should run",
                    "type": "string"
                }
            },
            "additionalProperties": false
        },

        "harmony-controller": {
            "description": "The configuration for the PowerPi Harmony controller Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "controller"
                },
                "global": {
                    "$ref": "#/$defs/global"
                }
            },
            "additionalProperties": false
        },

        "lifx-controller": {
            "description": "The configuration for the PowerPi LIFX controller Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "controller"
                },
                "global": {
                    "$ref": "#/$defs/global"
                }
            },
            "additionalProperties": false
        },

        "mosquitto": {
            "description": "The configuration for the PowerPi Mosquitto MQTT service Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "message-queue"
                },
                "global": {
                    "$ref": "#/$defs/global"
                }
            },
            "additionalProperties": false
        },

        "network-controller": {
            "description": "The configuration for the PowerPi Network controller Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "controller"
                },
                "global": {
                    "$ref": "#/$defs/global"
                }
            },
            "additionalProperties": false
        },

        "node-controller": {
            "description": "The configuration for the PowerPi Node controller Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "controller"
                },
                "global": {
                    "$ref": "#/$defs/global"
                }
            },
            "additionalProperties": false
        },

        "persistence": {
            "description": "The configuration for the PowerPi Persistence service Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "database"
                },
                "global": {
                    "$ref": "#/$defs/global"
                }
            },
            "additionalProperties": false
        },

        "scheduler": {
            "description": "The configuration for the PowerPi Scheduler service Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "scheduler"
                },
                "global": {
                    "$ref": "#/$defs/global"
                }
            },
            "additionalProperties": false
        },

        "smarter-device-manager": {
            "description": "The configuration for the Smarter Device Manager Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "device-manager"
                },
                "global": {
                    "$ref": "#/$defs/global"
                }
            },
            "additionalProperties": false
        },

        "ui": {
            "description": "The configuration for the PowerPi UI service Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "ui"
                },
                "global": {
                    "$ref": "#/$defs/global"
                }
            },
            "additionalProperties": false
        },

        "virtual-controller": {
            "description": "The configuration for the PowerPi Virtual controller Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "controller"
                },
                "global": {
                    "$ref": "#/$defs/global"
                }
            },
            "additionalProperties": false
        },

        "voice-assistant": {
            "description": "The configuration for the PowerPi Voice Assistant service Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "voice-assistant"
                },
                "global": {
                    "$ref": "#/$defs/global"
                }
            },
            "additionalProperties": false
        },

        "zigbee-controller": {
            "description": "The configuration for the PowerPi ZigBee controller Helm chart",
            "type": "object",
            "properties": {
                "component": {
                    "const": "controller"
                },
                "global": {
                    "$ref": "#/$defs/global"
                }
            },
            "additionalProperties": false
        }
    },


    "$defs": {
        "global": {
            "type": "object",
            "properties": {
                "env": {
                    "description": "The environment to deploy for 'production' or 'dev'",
                    "type": "string",
                    "enum": ["dev", "production"]
                },

                "externalHostName": {
                    "description": "The external host name to use when requesting certificates and to configure for ingress",
                    "type": "string",
                    "pattern": "^\\w+(\\.\\w+)+$"
                },

                "certificateEmail": {
                    "description": "The email address to use for HTTPS certificate renewal",
                    "type": "string",
                    "format": "email"
                },

                "useSSL": {
                    "description": "Whether to use SSL for the UI, API and voice integration",
                    "type": "boolean"
                },

                "useCluster": {
                    "description": "Whether PowerPi is deployed in a kubernetes cluster (i.e. has more than 1 node)",
                    "type": "boolean"
                },

                "useSensors": {
                    "description": "Whether to allow access to the message queue from outside of kubernetes (to support external sensors publishing events)",
                    "type": "boolean"
                },

                "freeDNS": {
                    "description": "Whether to deploy the FreeDNS service",
                    "type": "boolean"
                },

                "config": {
                    "description": "Whether to include the config-server service to get configuration from GitHub",
                    "type": "boolean"
                },

                "persistence": {
                    "description": "Whether to include the persistence service to store messages in a database",
                    "type": "boolean"
                },

                "scheduler": {
                    "description": "Whether to include the scheduler service to update devices on a schedule",
                    "type": "boolean"
                },

                "voiceAssistant": {
                    "description": "Whether to include the voice assistant service for Alexa integration",
                    "type": "boolean"
                },

                "energenie": {
                    "description": "Whether to include Energenie support",
                    "type": "boolean"
                },

                "harmony": {
                    "description": "Whether to include Logitech Harmony support",
                    "type": "boolean"
                },

                "lifx": {
                    "description": "Whether to include LIFX support",
                    "type": "boolean"
                },

                "zigbee": {
                    "description": "Whether to include ZigBee support",
                    "type": "boolean"
                },

                "network": {
                    "description": "Whether to include control of networked devices (i.e. computers)",
                    "type": "boolean"
                },

                "node": {
                    "description": "Whether to include node monitoring support",
                    "type": "boolean"
                },

                "pijuice": {
                    "description": "Whether to include PiJuice support",
                    "type": "boolean"
                },

                "pwm": {
                    "description": "Whether to include node PWM fan control",
                    "type": "boolean"
                },

                "energy-monitor": {
                    "description": "Whether to include N3rgy energy monitoring support",
                    "type": "boolean"
                }
            },
            "additionalProperties": false
        }
    }
}
